#!/usr/bin/make
# @configure_input@

toolsdir = @PWD@/tools

WGET = @WGET@

SPKNAMES = bet eli eva jan mar ona pau pep pol teo uri
FULLSPKNAMES = $(addprefix upc_ca_,$(SPKNAMES)) 

# upc_ca_base: # config: downl, extract and mv to festival/lib !! languages.scm conflict
upc_ca_base_File = upc_ca_base.tgz
upc_ca_base_MD5 = 137b9ac940c0680e783530670379998f
upc_ca_base_URL = http://www.talp.cat/festcat/src/upc_ca_base-1.0.5.tgz

# ca_hts_template: # config: extract and mv
ca_hts_template_File = ca_hts_template.tgz
ca_hts_template_MD5 = b026974396bcae094c978b0f3f7cc0b1
ca_hts_template_URL = http://www.talp.cat/festcat/src/ca_hts_template.tgz

ALLDOWNLOADS = $(addsuffix _raw,$(FULLSPKNAMES)) $(addsuffix _utt,$(FULLSPKNAMES))
ALLCONFIGURES = HTSDemo
download_all = $(addprefix download_,$(ALLDOWNLOADS)) download_upc_ca_base
configure_all = $(addprefix configure_,$(ALLCONFIGURES)) 

download_all_utt = $(addsuffix _utt,$(addprefix idown_,$(FULLSPKNAMES)))
download_all_raw = $(addsuffix _raw,$(addprefix idown_,$(FULLSPKNAMES)))

all2: $(download_all_utt)

all: lang_ca

lang_en: $(download_all) $(configure_all)

# This target will check if the downloads are correct. If they are not
# it will download them again, using a password if needed.
download: $(download_all)


upc_ca_base: download_upc_ca_base
	echo "TODO: Configure upc_ca_base"

upc_ca_%: download_upc_ca_% configure_upc_ca_%

download_upc_ca_base:
	echo $@ && \
	echo $(subst download_,,$@) && \
	mkdir -p $(subst download_,,$@)  && \
	echo "$($(subst download_,,$@)_MD5)  $($(subst download_,,$@)_File)" | md5sum -c --status && echo "$(subst download_,,$@) already downloaded" || \
	( rm -f $($(subst download_,,$@)_File) && \
	$(WGET) --output-document=$($(subst download_,,$@)_File) $($(subst download_,,$@)_URL) )

download_%: idown_%_raw idown_%_utt

idown_%_raw: md5sum.txt
	mkdir -p $* && \
	cd $* && \
	grep "$*_raw48.tar.bz2" < ../md5sum.txt | md5sum -c --status && echo "$* (raw) already downloaded" || \
	( rm -f "$*_raw48.tar.bz2" && \
	$(WGET) http://www.talp.cat/festcat/src/$*_raw48.tar.bz2 )

idown_%_utt: md5sum.txt
	mkdir -p $* && \
	cd $* && \
	grep "$*_utts.tgz" < ../md5sum.txt | md5sum -c --status && echo "$* (utts) already downloaded" || \
	( rm -f "$*_utts.tgz" && \
	$(WGET) http://www.talp.cat/festcat/src/$*_utts.tgz )

md5sum.txt:
	$(WGET) http://www.talp.cat/festcat/src/md5sum.txt || exit 1

configure_%: download_%
	echo "To do $@"
#	mkdir -p template raw utts wav && \
#	mkdir -p utts/arctic-slt raw/arctic-slt && \
#	if [ ! -f template/configure.ac ] || [ ! -f raw/arctic-slt/cmu_us_arctic_slt_a0001.raw ] ; then \
#		tar xjf $(HTSDemo_File) && \
#		mv HTS-demo_CMU-ARCTIC-SLT/data/raw/*.raw raw/arctic-slt  && \
#		mv HTS-demo_CMU-ARCTIC-SLT/data/utts/*.utt utts/arctic-slt  && \
#		mv HTS-demo_CMU-ARCTIC-SLT/* template && \
#		rm -rf HTS-demo_CMU-ARCTIC-SLT; \
#	fi


